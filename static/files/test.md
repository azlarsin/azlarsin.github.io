title: one post~
author: azlar
date: 2016-09-06 21:43:54
tags: ['test', 'zxc']
---

#h5 任务计划
##已完成页面

###使用中
1. 产品详情页
2. 达人商城页
3. 购买产品页
4. 支付页

###需改善
1. 首页		1d
2. 产品列表页		0.5d	
3. 达人列表页		0.5d

##未完成页面
1. 达人服务详情页（**暂搁置**）
	- 详情页
	- 评论页
	- 分享图片页

2. 服务购买页（**暂搁置**）
	- 购买服务页
	- 确认订单页
	- 确认订单 - 商城 - （购物车下单）

3. 购物车（仅产品）
	1. 添加购物车		1d
	2. 购物车列表		1d
	3. 购物车下单页		1d	

4. 个人中心
	1. 订单列表		1d
	2. 订单详情		1d
	3. 修改密码		1d
	4. 评价订单		1d


##事项
1. 日历插件重写
2. **结构设计**
3. 路由封装
4. 结构导致的模块修改（重写）




##开发日历
* 11.27
	1. 修复 C 端 `达人商城页` 产品显示顺序。
	2. 修复 C 端 `达人商城页` 标题溢出问题。

* 11.28
	1. 确定做什么

	
* 11.30
	- branch `product-cart`
		1. 逻辑梳理
		2. 页面优化
		3. ==左侧菜单==
		4. 修复 C 端产品头部覆盖部分过多的样式问题

* 12.1
	- branch `product-cart`
		1. ==user 模块接口调试==
		2. ==登录页==
		3. 新日历(服务用) bug 修复

* 12.2
	- branch `product-cart`
		1. ==个人中心页==
		2. ==找回密码页==
		3. ==注册页==
		4. ==页面切换，左侧菜单事件==
		5. **禁止横屏**
		6. **滑动开合左侧菜单**

* 12.3
	- branch `product-cart`
		1. 优化：左侧菜单点击后切换页面的动画（先关掉菜单，再打开新页面）
		2. 注册登录页，禁止滑动菜单
		3. 注册登录、找回密码，皆可返回之前页面
		4. ==订单列表页==
		5. ==订单详情页（80%）==
			- 样式与部分逻辑
	
	- branch `master`
		1. 微信浏览器内显示微信支付，其他浏览器内不显示微信支付

* 12.4
	- branch `product-cart`
		1. ==订单详情页（20%）== 
			- `取消订单` 
			- `申请退款` 
			- `立即支付`

	- server side
		1. 取消订单相关操作： 由之前 `交易成功` 不可以退款，修改为可以 `申请退款`，申请后，主订单、产品子订单 状态修改为 `退款中`

	- branch `master`
		1. style fix
		
			```
			1、C端H5页面，立即购买的按钮（参考B端新版）
			2、产品详情页，最下方立即支付按钮颜色（参考B端新版）
			3、产品详情页字体大小偏小
			4、支付页面最下方，联系人字体大小偏小
			5、支付页面最下方，立即支付按钮颜色
			```

* 12.7
	- branch `product-cart`
		1. ==重构产品购买页（逻辑）==
		2. ==添加联系人页面==

	- branch `master`
		1. 购买页日历隐藏(需求)
		2. “一价全包” 产品添加购前协议(需求)

* 12.8
	- branch `master`
		1. 购买页日历隐藏(实现)
			- 隐藏购买页日历选项，选中日期后自动隐藏、点击购买自动检测
		2. “一价全包” 产品添加购前协议、**达人商城也跳转问题**(实现)
			- 重写提示信息框组
		3. 日历翻月，不会提示（bug 修复）
			- 翻页后为日期绑定事件

* 12.9
	- branch `product-cart`
		1. ==购物车列表页（70%）==
			- 样式
			- 滑动显示删除框（由于菜单滑动事件为全局事件，需要判断触摸位置）
			- 删除动画

* 12.10
	- branch `product-cart`
		1. ==购物车列表==（30%）
			- 缓存逻辑
			- 下单逻辑
			- 删除购物车逻辑

		2. ==添加联系人页面部分逻辑==（主要配合来源不同的跳转逻辑）
			- 跳转逻辑
			
					1. 单项产品	=>	一条订单	=>	支付页
					2. 多项产品（同一达人）	=>	一条订单（一主多子）	=>	支付页
					3. 多项产品（不同达人）	=>	多条订单（多主多子）	=>	订单列表页（伴随提示）	(=>	聚合支付)
		
		3. 购物车数量自动获取并显示

	- server side
		1. 获取购物车数量接口
		2. 优化了购物车下单的部分逻辑，防止错误导致的程序崩溃（与订单部分一样，改为抛出异常，以不影响前端流程）


* 12.11
	- branch `product-cart`
		- 左侧菜单样式修改
		- 订单列表页面下拉加载实现

	- server side
		- 配置 `travelagency.dogplanet.cn`


* 12.13/14
	- branch `product-cart`
		1. 小东反馈问题

			```
			C端反馈
			1.达人商城产品的分页，一页显示10条产品	(done)
			2.未登录的时候商城也显示左边的侧边栏	(done)
			3.支付里，微信放在第一个，支付宝，银联，在微信外打开的时候不显示微信	(done)
			4.订单的交易成功角标修改为已成功	(done)
			5.只有产品的订单，没有评价服务的入口	(done)
			6.只有产品的主订单的成功和已支付状态也是根据时间来判断，和子产品一致	(done)
			7.确定退款之后，提示运营人员会在两个工作日内核实退款信息，请耐心等待	(done)
			8.确认退款之后，订单状态修改为退款中	(done)
			9.购物车下面的按钮，修改为立即结算	(done)
			10.已经登录就不显示侧边栏的登录注册了	(done)
			11.登录之后默认的头像	(done)
			12.退出登录之后，个人中心没有侧边栏了	(done)
			13.交易关闭修改为已关闭	(done)
			14.个人中心的推荐导游，按照订单排名，取排名靠前的	(done)
			15.购物车里的产品，点击图片和标题跳转到产品详情页	(done)
			```
		
		2. bugfix && optimiztion
			- 订单列表页可能加载不到最后一页产品，算法修复
			- 订单详情页取消订单，按钮事件需要点击第二下才会触发，修正
			- 右上角提示框，图标与文字增加了一点间隔
		
	- server side
		1. 个人中心，获取推荐达人接口

* 12.15
	- branch `product-cart`
		1. 小东反馈问题
	
			```
			C端反馈
			1. 购物车跳转到产品，信息不全（由于跳转到了子产品的详情页，所以导致信息补全）	(done)
			2. 支付完后，菜单不显示	(done)
			3. lazy-load
			4. 订单列表信息不正确，不应该出现 立即评价 (done)
			5. 购物车样式问题 (done)
			6. 退款提醒	(done)
			```
			
		2. bugfix && optimiztion
			- 窗口滚动事件取消绑定（否则会导致页面在某些位置卡死）

		3. ==下单完成后发送初始密码==

* 12.16
	- branch `product-cart`
		1. bugfix && optimiztion
			- 商城也翻页加载在点击其他类型产品的之后会失效 (需重置页头)

	- branch  `master`
		1. 不登录使用购物车思路整理：
			- 前端购物车数据本地存储、整合
			- 前端购物车相关操作实现
			- 后端购物车下单逻辑（需要判断达人从属关系、多订单支付（未登录不能使用订单））
			- 与登录使用购物车兼容
		
* 12.17
	- branch `product-cart`
		1. ==不登录使用购物车实现==
		2. bugfix && optimiztion
			- 底部菜单字号缩小、缩进增加（购买产品页 iphone 5 按钮会覆盖价格）
			- 登录注册页信息提示


	- server side
		1. 通过验证码实现自动注册/登录功能

		
* 12.18
	- branch `master`
		1. 不登录使用购物车实现部署
		2. 订单标签颜色修改
		3. 购物车列表样式修复
		4. 注销后清空缓存数据（避免一些意外的 bug）

	- server side
		1. 通过验证码实现自动注册/登录功能（逻辑修正）
			- 修正前：之前购买过生成的用户会卡住，系统会判断为其已注册，但是其没有密码 与 token（后台未做处理）
			- 修正后：
	
					1. 未注册用户	->	自动生成密码	->	自动注册	->	发送密码	->	自动登录
					2. 12.15 之前付费购买过的用户	->	自动生成密码	->	自动更新信息	->	发送密码	->	自动登录
					3. 已有密码用户（主要来源为通过 注册页 注册的用户）	->	自动登录
	
* 12.19 （六）
	- branch `master`
		1. 合并 `product-cart` 分支

		
	- branch `style-revision`
		1. 新建分支
		2. 流程梳理

				1. 达人商城
				2. 产品详情页 （底部 button）
				3. 购买产品页 （日历重构）
				4. 确认订单
				5. 购物车
				6. 确认订单 （已登录）
				7. 支付方式
		
	- server side
		1. 文档整理（记录追加的一些接口）

* 12.21
	- branch `style-revision`
		1. ==我的商城==
		2. 线上 `错误信息提示` bugfix

* 12.22
	- branch `style-revision`
		1. ==日历样式重写（购买页）==

* 12.23
	- branch `style-revision`
		1. ==确认订单页==

* 12.24
	- branch `style-revision`
		1. ==订单列表页==
		2. ==订单详情页==

* 12.25

	- branch `style-revision`
		1. ==购物车页==
			1. 购物车样式
			2. 失效购物车判断
			3. 结算逻辑（增加无产品、失效情况）
		
		2. **公用底部菜单样式重写**

* 12.26 （六）

	- branch `style-revision`
		1. ==购买产品页==
		2. ==添加联系人页==
			1. 确认订单（购物车）
				- 产品列表显示
				- 前端分析用户勾选数据，由于后端没有根据特定购物车 id 获取购物车数据，所以暂由前端分析数据（日后需要改为向后端获取数据）

			2. 确认订单（直接支付）



* 12.28

	- branch `style-revision`
		1. ==支付页面==

	- branch `master`
		2. ==退款页==
			- 样式完毕，等待接口

* 12.29
	- branch `mater`
		- ==退款页调试==

* 12.30

	- branch `style-revision`
		1. 达人商城也背景图从压缩改为裁剪方式
		2. ==个人中心（首页）样式==
		3. 部署测服调试
		4. 合并 退款页

	- branch `master`
		1. 退款调试、上线

* 12.31
	- branch `style-revision`
		1. 底部菜单字体样式调粗（调至默认）
		2. 购买页人数选择框样式修复
		3. 购买页样式重写（获取验证码、填写验证码部分）

	- branch `master`
		1. 部署 `style-revision` 
		2. 细节修复 （样式：边框细节）

	- server side
		1. 支付回调（后台回调）内增加 “第三方订单号”、“支付方式名称”


* 1.4
	- branch `master`
		1. 购物车页面，滑动会触发左侧菜单（已修复）
		2. 订单详情页，增加退款金额
		3. 订单详情页，能否退款判断

	- server side
		1. 订单详情接口，追加退款金额 `refundNum` `refundAmount`
		2. 订单详情接口，追加能否退款状态 `refund`

* 1.5
	- branch `search-index`
		1. 首页逻辑修复
		2. 产品详情页达人头像尺寸调整
		

	- server side
		1. 现在支付回调过慢（第一次回调失败），原因排查：现在支付服务器所用 DNS 有时候检索不到 `dogplanet.cn`。


* 1.6
	- branch `master`
		1. 提出购物车按钮至 `header-banner` 右侧

	- branch `search-index`
		1. ==首页重写==

* 1.7 
	- branch `search-index`
		1. ==列表页样式（综合）==

	- server side
		1. 后台产品编辑增加了一个字段：`short_comment` (一句话简评)

* 1.8
	- server side
		1. C 端不能下单，紧急修复，产品子订单常量被删除

	- branch `search-index`
		1. ==列表页样式（达人）==
		2. ==列表页样式（产品）==
		3. 跳转逻辑（由于 `综合`、`达人`、`产品` 使用的是一个 `模块`，跳转的逻辑比较麻烦（不能触发页面更新效果））


* 1.9 (六)
	- branch `search-index`
		1. 跳转逻辑拆分
			- 之前的实现有 bug，总是不能正常跳转

* 1.10 (日)
	- branch `search-index`
		1. 跳转逻辑
		2. 部署到测服（测试）

	- server side
		1. 文档整理
			- 追加接口文档完善

* 1.11
	- branch `search-index`
		1. 样式修复（小东、高盼提出问题）
	
	- server side
		1. 首页接口修复（只允许检索主产品）
		2. 列表页接口修复（只允许检索主产品）

* 1.12
	- branch `search-index`
		1. ==产品详情页==
		2. 达人商城页景区 banner 追加
		3. 测试环境部署（测试）

* 1.13
	- branch `search-index`
		1. 产品推荐的达人乱序排列
		2. 首页背景小图替换
		3. 部署线上
		4. bugfix && optimiztion
			- 购物车删除按钮 bug （不显示的时候也可以点击）
			- 平台商品添加购物车失败
			- 小东提出问题
				
				```
				1.当地达人在综合列表页，最多展现3个，超过3个的时候显示更多，点击更多之后到达人的列表页，<=3个的时候，不显示更多的按钮 （done）
				2.综合搜索结果页，产品，最多展示5个产品，超过5个产品的显示更多按钮，<=5个产品的时候不显示更多按钮（done）
				3.综合列表页和达人列表页、平台产品详情页的服务达人，只展示已经认证成功的（done）
				4.把综合搜索结果页，产品搜索结果页，商城页的产品价格的起，暂时隐藏，不要删除（done）
				5.购买产品选择人数的输入框，可以先不显示背景，在输入完成之后再显示背景吗？
				6.平台产品加入购物车不可以（done）
				```
			- 优化
				1. 购物车页面样式修复（购物车过多时，最后一条记录会与底部 banner 重合（紧贴），增加了他们之间的距离）
				2. 增加了 not-found-url (访问其他（不存在的）页面时候，会跳转到首页)：
		
				```
	            <Route path="*" component={Index}/>
				```
			
			
	- server side
		1. 产品推荐的达人乱序排列
		2. **C 端所有使用到达人的地方，获取达人的方式，均需要（达人）完成验证**
		3. 首页检索、产品详情页，产品推荐的达人数量固定（需要从 `认证的达人` 内筛选出 10 个）

* 1.14
	- branch `master`
		1. 处理 `search-index` 上线后的 bug
			- 字体大小导致的达人介绍文字溢出
			- 首页上部尺寸计算（之前使用 css 的 `calc()`， 某些安卓机器不支持）
	
	- branch `expert-dev` （==等待设计稿件中==）
		1. 达人详情页样式调整
		2. 购买服务页样式调整

* 1.15
	- branch `master`		
		1. 微信支付衍生问题：
			- 购买平台商品回调错误（回调至 `达人商城页`）
			- 打开 `订单详情页` 错误，由于没有达人信息

	- server side
		1. 支付接口修改
			- 微信支付参数改变
			- 微信支付单独的前端回调

* 1.18 （一）
	- branch `master`
		1. `一价全包`、`门票`，两个产品禁止加入购物车
		2. bugfix
			- 订单详情页，退款一个商品后，另外一个商品不能 `申请退款`（绑定事件失效）

* 1.19
	- branch `expert-dev`
		1. 达人详情页样式 （完善中）

* 1.20
	- branch `pack-products`
		1. ==打包产品详情页== 前端实现 （无接口，模拟实现）
		2. 接口部分逻辑实现（表还没建好，等）

* 1.21
	- branch `pack-products`
		1.  ==打包产品详情页== 前端实现 （接口实现）

	- server side
		1. ==打包产品详情页，接口实现==
		2. ==获取达人打包产品（目前用于达人商城页），接口实现==

* 1.22
	- branch `pack-products`
		1. 打包产品购买页（兼容之前路由、逻辑）
		2. 打包产品添加联系人页（兼容之前路由、逻辑）

	- server side
		1. ==打包商品下单接口实现==

* 1.24 (日)
	- branch `pack-products`
		1. 达人商城页，产品排序实现
		2. 订单详情页样式修复（子订单过多，样式被撑开，修复）

	- server side	
		1. 接口整理
		2. 部署到测服，等待测试（已自测）

* 1.25（一）
	- branch `pack-orders`
		1. 样式微调

	- branch `expert-dev`
		1. 达人服务讨论

	- server side
		1. 接口微调（打包产品接口追加 `expertId` 即 `达人 id` 参数）

* 1.26
	- branch `expert-dev`
		1. 达人个人中心页
	
* 1.27
 	- branch `expert-dev`
		1. 达人个人中心页

	- branch `pack-products`
		1. optimiztion
			- 达人商城页，未注册的达人不显示信息（跳转到首页）
			- 打包产品详情页，产品过多时候，会被 `footer` 遮蔽，已修复
			- `取消订单` 按钮改为 `白色`
		2. 重写达人商城页，打包产品显示，（**旧逻辑（使用 js 改变元素位置）会影响到 `react` 自身的 `state` 的切换，导致其他 type 的产品显示出现问题**）

			```javascript
			self._initialPackProductsPosition();
	
		    _initialPackProductsPosition: function () {
		        //pack-products position
		        var packs = $('.product.package');
		
		        if(packs.length >= 0) {
		
		            packs.each(function () {
		                var products = $('.product');
		                products.eq(parseInt($(this).data('position'))).before($(this));
		            });
		        }
		    },
		
			```
			=>
			
			```javascript
			if(packages.length > 0) {
				products = this._mergePack(products, packages);
			}
			
			_mergePack: function (products, packages) {
			    var product;
			
			    for(var i in packages) {
			        product = {
			            id: packages[i].id,
			            name: packages[i].name,
			            price: packages[i].price,
			            thumb: packages[i].thumb,
			
			            //self attr
			            pack: true
			        };
			
			        products.splice(parseInt(packages[i].position), 0, product);
			    }
			
			    return products;
	},
			```
	- server side
		1. 达人商城页接口，达人未注册的时候返回空数据


* 1.28
	- branch `pack-products`
		1. 上线部署，bug 排查

		
	- branch `master`
		1. 样式调整（from **高盼**）
		
			> https://tower.im/projects/33a9cc36df1b47d18fd2d3998d6a851c/todos/691940b3b65144aba0e1a6628f112162/

			> C端界面调整
			
			> 1/ 首页最省心的icon
			
			> 2/ 商城页导航分类（“推荐～美食～”）选中后的颜色状态要保持一致／间距调大些
			
			> 3/ 关于金额的表现形式——人民币￥加金额
			
			> 6/ 联系方式界面立即支付按钮的文案调整为“确认下单”
			
			> 7/ 购物车界面失效的产品放在下面~~选中的icon不好点~~左划删除icon下面加文字“删除”
			
			> 8/ 我的订单订单icon
			
			> 9/ 订单详情————取消订单色值＃ffffff（白色）“订单总计。。。联系电话”的白卡片与标题栏间距20px
			
			> 10/ 订单状态标签颜色调整 文件已发送
			
			> 11/ 购物车列表为空的时候占位图，购物车列表页不显示右上角 cart-icon

			
		2. **`1`** 中调整已经随 `pack-products` 分支上线，剩余未调整项随后上线


* 1.29
	- branch `pack-products`
		1. 去除付款后返回 `达人商城页` 的底部提示（`查看订单` 与 `反馈`）

	- branch `master`
		1. optimiztion
			- 左侧菜单，点击宽部区域触发点击事件（以前必须点击到文字才会触发）
			- **`达人商城页` 文字介绍溢出时，显示省略号** (根据手机不同做判断~)
			- `购买产品页` 点击 `其他` 时，若关闭键盘，自动重新选中 `1` 人

	
		
		
* 2.1
	- branch `master`
		1. 小细节修改
			- **细节修饰** （主要为一些白块的边框）
				1. `添加联系人页`
				2. `购买产品页`
				3. `达人商城页`
			- 取消订单提示信息（暂未上线）

* 2.2
	- server side
		1. 后台 bug 修复
			- 主产品不能编辑（编辑失败）
			- 子产品编辑失败（编辑报错）

* 2.15
	- branch `expert-dev`
		1. ==达人详情页== 页（完成）

* 2.16
	- branch `expert-dev`
		1. 评论页面
		2. **订单列表页，前进、后退，不重新加载数据**
		3. 订单列表、订单详情，tag 字体倾斜

* 2.17 
	- branch `expert-dev`
		1. 评论页面（完善）

* 2.18
	-branch `expert-dev`
		1. UC 浏览器下，达人商城也可能加载重复商品（加载的时候继续下拉，触发加载），BUG 修复 （暂未上线）
		2. 模块化分（一小部分 `达人服务` 代码重构）

* 2.19
	- branch `expert-dev`
		1. 购买服务页面重写（之前写了部分）
	
	- branch `master`
		1. **蜈支洲门票禁止购买**

		
* 2.22
	- branch `expert-dev`
		1. 购买服务页 - `选择日期样式`

	- server side
		1. 修复了已注册用户再次购买可能会重新生成密码的问题

* 2.23
	- branch `expert-dev`
		1. 购买服务页 - `选择日期样式、动画逻辑`

	- server side
		1. 接口更新（由于产品原型图修改， 达人服务接口需要含有达人的基本参数（之前仅有日历参数））

* 2.24
	- branch `expert-dev`
		1. 购买服务页 - `价格逻辑`
		2. 字体统一
			- 产品详情页 ueditor 字体统一（之前只统一了大小，这次统一的有：`font-weight`, `font-family`, `color` 等属性）

	- service side
		1. 开放 **`未认证达人`** 的 C 端使用权限

* 2.25
	- branch `expert-dev`
		1. 价格逻辑、翻页（月）逻辑
		
	- branch `mster`
		1. 未认证达人在达人商城页不显示 `未认证提示信息`

* 2.26
	- branch `expert-dev`
		1. 购买服务页，数据整理（cache）

	- branch `sell-out`
		1. 产品售罄、下架逻辑

* 2.28
	- branch `sell-out`
		1. 售罄、下架

	- server side
		1. 售罄、下架 接口
		2. 一些逻辑问题
	
				1. 产品下架功能在主产品上（主产品不应该具有该属性）
				2. 产品列表页面需要确认是否售罄（主产品列表页需要遍历所有的子产品，虽然现在是 一主一子 的关系，但之后会无法判断主产品是否售罄）
		
		3. 由于必须兼顾到 **以后的多子产品** 与 **目前的单子产品** 的情况，这块花了很多时间（以后会废弃这段逻辑）
		

* 2.29
	- server side
		1. 售罄、下架 接口

* 3.1
	- server side
		1. 售罄、下架 接口
		2. 后台上下架自动 push 到 `product_search` 表

	- branch `sell-out`
		1. 购买产品页，关于售罄商品日期选择处的逻辑
			
				1. 打包产品进入购买页，不会选择好日期
				2. 选择日期后，若有 “售罄商品”，提示用户，并动态计算价格
				3. 若选择日期，所有的产品均售罄，提示用户，并禁止购买
			
		2. 下单逻辑（本地 `sessionStorage` 的变化（根据所选日期判断是否有产品下架））
		3. 测试
		4. 部署测服
	
* 3.2
	- server side
		1. 售罄、下架 接口

	- branch `sell-out`
		1. 调试、修改与优化
			
				1. 单产品下单售罄逻辑
				2. 打包产品详情页，下架产品提示
				3. 打包产品购买页面，逻辑修复

* 3.3
	- server side
		1. 售罄、下架 接口
			
				1. 搜索页（首页）、列表页、详情页，增加 下架 产品判断，若已经下架，给出提示

		2. 售罄、下架, 线上部署

	- branch `sell-out`
		1. 售罄、下架, 线上部署

* 3.4
	- server side
		1. 售罄、下架
			- 购物车、订单结算判断（10%）
		
	- branch `sell-out`
		1. 售罄、下架
			- 购物车、订单结算判断（10%)

* 3.7 
	- server side
		1. 退票接口，数量控制
		2. 订单详情页，每个子订单可以申请退款的数量（参数追加）
		
	- branch `refund num`
		1. C 端所有 `alert（提示）信息` 样式改变
		2. 退款详情页逻辑（人数）
		3. 部署到线上

* 3.8
	- server side
		1. 售罄、下架
			- 购物车、订单结算判断（完成）
		2. 测试、部署上线
	- branch `sell-out`
		1. 售罄、下架
			- 购物车、订单结算判断（完成）
		2. 测试、部署上线

* 3.9 请假

* 3.10 
	- branch `master`
		1. 字体样式修复
	
	- branch `expert-dev`
		1. 购买服务页，逻辑整合（价格计算后操作）

* 3.11 
	- branch `expert-dev`
		1. 暂停开发，开会讨论下一步策略
	
	- server side
		1. 制定接口最优策略
			1. 接口减少不必要返回参数（由于很多接口需要大量复用，所以需要重新设计）

* 3.12（六）
	- server side
		1. 用户中心页，达人接口参数缩减
			
			```php
	    	foreach($orderModels as $orderModel) {
	            $expertModel = Expert::findOne($orderModel['expert_id']);
		
	            if(null != $expertModel) {
		
	                //reduce attrs
	                $expert['id'] = $expertModel->id;
	                $expert['name'] = $expertModel->expert_name;
	                $expert['avatar'] = SysImages::getImageUrlById($expertModel->expert_icon);
	//                $expert = $expertModel->processExpertWithoutService();
	//                $expert['orderCount'] = $orderModel['orderCount'];
		
	                array_push($experts, $expert);
	            }
        }

			```
			
		2. 推荐达人排序

* 3.14 ~ 3.18
	- 后台统计功能
		1. 搜索查询
		2. 导出

* 3.20（日）
	- server side
		1. 多景区接口逻辑设计（构想阶段）

	- branch `master`
		1. 列表页样式修改（图片比例）

* 3.21
	- server side
		1. 多景区接口逻辑设计
	
	- branch `master`
		1. 逻辑修复（一些已知问题（非紧要、不影响功能）的试探解决）
		2. 辅助码显示

* 3.22
	- server side
		1. 多景区接口逻辑设计
	
	- branch `master`
		1. **`node` 试验，之后可能会把 `nginx` 换成 `node`，`hash history` 换成 `broswer history`**

* 3.23
	- branch `master`
		1. bugfix (all done)
		
			```
			1.加入4月份的产品会直接显示失效
			2.加入购物车的时候如果没有登录，出现那个浮层验证手机的时候的，样式出问题了
			3.购买产品选择日期页面，底部的日期出现一条背景色，如果日历展开的时候，选择人数在6上回隐藏一部分在购买按钮下，点击输入人数之后也没有顶起来输入框，不能有输入框的时候都把下面的支付按钮顶起来吧？
			4.现在注册输入密码的时候，如果不正确，会有提示，先不要把按钮灰掉，点击提交的时候在判断下，如果密码不符合在给下提示
			5.验证码登录的提交，文字修改为登录
			6.产品页，多次上拉的时候会数据重复
			```

	- server side
		1. 统计模块追加需求 by 覃兴（下午 C 端开会定稿）

* 3.24
	- server side
		1. 统计模块追加需求 by 覃兴（实现）
	
	- branch `ticket-rule`
		1. 提出需求
			
				1.扫描导游二维码进入的商城，不可以购买；
				2.扫描达人二维码进入的商城，两个小时内最多下一个订单（包含导游下的订单和该用户自己下的订单），每单最多5张票；
				3.扫描达人二维码进入的商城，购买门票选择日期页，购买按钮正常，如果不能购买，点击购买按钮提示【XXXX分钟后可以购买，请稍后购买~】
				
		2. 逻辑设计

* 3.25
	- server side
		1. 统计模块微调

	- branch `ticket-rule`
		1. 商品详情页，添加达人验证（若达人不存在，跳回主页）
		2. 计划将 **`购买产品页的产品判断逻辑迁移到后台`**
			* 一价全包、门票，不可加入购物车
			* 门票，达人可购买，导游不可以购买
			* 特殊产品可能不能购买（下架产品不显示，可能有其他类似 `不可添加到购物车` 的需求）
			* 人数限制

* 3.27（日）
	- server side
		1. 3.25 中 rule 的后端判断逻辑实现
		2. 门票限时、限量构思中
	
	- branch `ticket-rule`
		1. 门票限制，前端判断实现
	

* 3.28
	- server side
		1. 用户使用 redis key 实现，达人根据订单判断
	
	- branch `ticket-rule`
		1. 逻辑实现、调试

* 3.29
	- server side
		1. 接口微调
		
	- branch `ticket-rule`
		1. 购买页，日期选择输入框光标闪烁，去除。
		2. 部署上线

* 3.30
	- server side
		1. 统计（导出）追加字段
			
			```
			各渠道交易额
			各项排行
			```
		2. 银联归属银行查询接口

* 3.31
	- server side
		1. 统计 bugfix
		2. 多景区接口规划
	

* 4.1
	- server side
		1. 统计 bugfix

	- branch `master`

		
* 4.2
	-server side
		1. 多景区获取达人拥有产品类别 接口
		2. 商城页产品接口
			- 由于数据结构问题，需要修改后台 `达人推荐产品` 存储方式（之前为一串，需要改为按景区存储）

* 4.3
	- branch `multi-poi`
		1. 前端页面实现（逻辑还未实现，等明天改完接口后再写）

	- branch `master`
		1. 修复日期判断
		2. 购买产品页，点击购买按钮后，日期判断的提示（之前为：该产品今日售罄，改为 “请选择晚于今天的日期”）

* 4.4
	- branch `multi-poi`
		1. 前端点击逻辑
	
	- server side
		1. 等待后台修改 推荐产品 保存方式

* 4.5
	- branch `multi-poi`
		1. 前端逻辑（景区切换后获取分类、产品、打包产品）

* 4.6
	- branch server side
		1. 后台产品筛选逻辑模拟（需要等数据结构修改）

* 4.7 
	- branch `multi-poi`
		1. 前台点击逻辑（缓存逻辑）

	- server side
		1. 等待接口中

		
* 4.8
	- branch `master`
		1. 升级版本到 react 15.0.0
		2. 部署到测服测试

* 4.10
	- branch `master`
		1. 购物车列表页，增加滑动参数
		1. 部署到线上

* 4.11
	- branch `wechat`
		1. 订单详情页，微信二维码关注公众号

* 4.12
	- branch `wechat`
		1. 动画效果优化（提速）
		2. 部署上线
		3. 优化了上线的 js 文件，缩小了 100k 的容量（采用生产环境压缩）

* 4.13
	- branch `master`
		1. 添加身份证输入框（判断逻辑需要等多景区完成之后再写）
* 4.14
	- branch `multi-poi`
		1. 达人商城页改写，使用 `promise`（由于发起的请求太多）

	- server side
		1. 多景区获得达人所有的景区

* 4.15
	- branch `multi-poi`
	- server side
		1. 多景区获取景区产品

* 4.16
	- branch `muliti-poi`
		1. 多景区前端缓存逻辑

* 4.17
	- branch `multi-poi`
		1. 重写商城逻辑


	- server side
		1. 重写商城逻辑
		2. 部署到测服

* 4.18
	- branch `multi-poi`
		1. 部署到测服、测试

	- server side
		1. 同步所有推荐产品的景区序列（脚本）

* 4.19
	- branch `multi-poi`
		1. 产品判断是否需要加 `身份证输入`

	- server side
		1. 产品、打包产品判断是否需要 `身份证输入`

* 4.20
	- branch `multi-poi`
		1. 购物车判断是否需要 `身份证输入`
		2. `多景区`、`身份证` 部署上线、测试

	- server side
		1. 购物车判断是否需要 `身份证输入`
		2. `多景区`、`身份证` 部署上线、测试

* 4.21
	- branch `multi-poi`
		1. 商城也不能下拉翻页（翻页请求数据没有追加 `景区 ID` 参数）

	- branch `master`
		1. 购物车滑动事件重写（垃圾箱动画）

* 4.22
	 - branch `master`
		1. 准备使用 lazy-load

	- branch `c-2`
		1. 首页改版

* 4.25
	- branch `master`
		1. 在 `添加联系人` 页面，用户获取验证码后会自动注册、登录，以后再不会有 `userId` = `99999` 挂靠在平台的临时账户；所有用户获取验证码后，点击下单后，自动注册（不管支付与否）

	- branch `c-2`

	
* 5.4
	- server side
		1. bugfix: 门票类检查 bug，用户下单其他产品后，可能会不能购买门票产品（禁止用户购买门票被误触发）
		2. 帮新员工配置环境，git，php, xampp
		3. 门票限制功能追加：达人在 B 端购买后，不可以用自己手机号去 C 端购买

	- branch `c-2`
		1. 首页改版

* 5.5
	- branch `c-2`
		1. 首页页面完成，包括自动为图片适配高度

* 5.6
	- server side
		1. 设计 C 端首页数据结构
		2. 开发后台配置 C 端首页数据功能（50%，样式基本调完，周日写逻辑）
		3. **==修复左侧菜单展开事件==**
			- 由于之前使用的验证规则为模糊匹配，导致某些路由的 关键字 会触发其他菜单
			- 提高了匹配的精确度，防止误触发

* 5.7（六）
	-server side
		1. 开发后台配置 C 端首页数据功能（达人逻辑部分）

* 5.8 （日）
	-server side
		1. 开发后台配置 C 端首页数据功能（产品逻辑部分、接口部分）

* 5.9
	- branch `c-2`
		1. 搜索页模块建立（换前端 ES6 写法，费了点时间）
		
	- server side
		1. 修复因为 删除子产品 导致的 `package_info` 冗余数据，而影响 `product_search` 跑出 0 元产品的问题

* 5.10
	- branch `c-2`
		1. 搜索页样式

* 5.11
	- branch `c-2`
		1. 搜索页样式、路由、逻辑

	- server side
		1. `order_product` 平台脚本

* 5.12
	- branch `c-2`
		1. 搜索列表页样式

* 5.13
	- branch `c-2`
		1. 搜索列表页逻辑
		2. `react router` 升级到 2.4.0，修复版本变化带来的 语法问题

* 5.14（六）
	- branch `master`
		1. `react router` 升级到 2.4.0，修复版本变化带来的 语法问题（路由书写方式调整）
		2. bugfix
			- 达人商城页，点击选择景区后，在为选择景区的情况下，点击购物车，会跳转到购物车页面，此时浮层未隐藏，会导致购物车内无法操作
	- server side
		1. 取消订单后，删除门票限制的 redis-key（分为主子订单）

* 5.16
	- branch `c-2`
		1. 搜索列表页面
			- 无结果页面
			- 达人样式

	- server side
		1. 列表页达人数据接口，增加 `性别`、`赞（推荐）`、`职业`，其中 **`职业`** 需要 B 端添加

		
* 5.17
	- branch `c-2`
		1. 搜索筛选页（达人）`样式`

* 5.18
	- branch `c-2`
		1. 搜索筛选页（达人）`样式`

* 5.19
	- server side
		1. 指导道山 `权限控制`
		2. bugfix 取消门票订单，用户 cache-key 仍然存在，修复

	- branch `c-2`
		1. 筛选样式

	- meeting
		1. 讨论 `服务` 实现的改版逻辑，由以前 **早中晚** 变成现在的 按天计算、定制服务

* 5.20
	- branch `c-2`
		1. 搜索筛选页需要重新做（由于服务的改版，重新出了图）

* 5.21（六）
	- branch `c-2`
		1. 搜索结果页重写
		2. 达人搜索页新样式

* 5.23 请假

* 5.24
	- branch `c-2`
		1. 搜索页重写、确定一些小细节（如亮点显示个数、产品图片形状）
		2. 达人筛选页样式完毕（高盼修改后的新版，明天写逻辑部分）

* 5.25
	- branch `master` & server side
		1. 小东临时需求：

			```
			1. 在达人商城里购买所有的产品都需要添加身份证；
			2. 两个小时之内只能在一个达人商城购买产品，选择完日期之后点击立即购买的时候，如果最后一个订单的达人不是现在选择的产品的达人，提示【根据景区规定，两个小时内只能在同一个达人商城购买产品】
			3. 购物车内含有达人产品时，需要填写身份证
			```
		
		2. 测服测试后部署到线上
		3. bugfix： 达人商城页，翻页失效
		
	- branch `c-2`
		1. 达人筛选页前端逻辑，后端筛选暂时不能做（服务还没有定）
		2. 达人筛选页，筛选样式又需要改版（由于当前版，无法展示用户已经选定的条件）
		3. 产品筛选页（搭建、初步样式）

* 5.26
	- branch `c-2`
		1. 产品筛选页，景区产品数量接口
		2. 产品筛选样式写完后，圆圆说需要修改，下午定版后再开始写
		3. 主题页（首页点击更多）搭建、样式

* 5.27
	- server side
		1. bugfix：达人 3707，B C 端报错，由于推荐产品过多导致


	- branch	`master`
		1. 达人商城页添加景区过多时候，景区筛选浮层不能滑动，添加滑动支持

	- branch	`c-2`
		1. 主题页开发

* 5.28（六） 
	- branch	`c-2`
		1. 筛选页开发

	- server side
		1. 首页数据接口

* 5.30
	- branch `c-2`
		1. 首页样式调整
		2. 购物车样式改版

* 5.31
	- branch `c-2`
		1. 购物车逻辑（全选按钮）
	
	- server side
		1. 购物车接口（追加显示字段）

* 6.1
	- branch `c-2`
		1. 个人中心样式、逻辑

	- server side
		1. 个人中心接口重做
		2. 用户表（个人中心）字段追加（性别、居住地等）

* 6.2
	- branch `c-2`
		1. 订单列表页
		2. 订单详情页（50%）

	- server side
		1. 订单列表页接口数据追加
		
* 6.3（六）
	- branch `c-2`
		1. 完善各页面功能，准备上线
		
			```
			1. 首页最近访问达人记录
			2. 首页数据的后台接口
			3. 订单详情页，立即支付按钮样式修复
			4. 首页、订单页，图片添加 lazy-load（之后会做 购物车、产品详情页、达人商城页的 lazy-load），这样可以节省用户流量，当用户滑到一定位置时，图片才开始加载
			```
			
* 6.4（日）
	- branch	`c-2`
		1. 完善、补全功能，准备上线
		
			```
			1. 首页跳转到专题页（缓存）
			2. 首页跳转到搜索产品页
			3. 搜索页 搜索历史纪录（缓存、唯一搜索记录，排序还未做）
			```
			
* 6.5
	- branch	`c-2`
		1. 完善、补全功能，准备上线

		```
		1. 达人筛选页，前后台逻辑
		```
		
	- server
		1. 服务器硬盘满，紧急修复（下午 4 点 - 6 点）

* 6.6
	- branch	`master`
		1. 配合后端 `蜈支洲门票需求`
	
	- server side
		1. 蜈支洲门票需求

			```
			1.用户两个小时之内只能从一个达人商城内购买产品，不论买哪天的产品；		   2.用户如果要从某达人商城中购买某天的二消项目（除了门船票、一价全包、极限运动以外的产品），必须在达人商城中购买过当天的门船票；
		   3.用户购买的单项二消项目的数量只能小于或者等于当天凌晨至当前时间之前所买门船票的数量。
			```
			
* 6.7
	- branch `c-2`
		1. 产品筛选页逻辑

* 6.8
	- branch `master`
		1. 蜈支洲门票测试、上线
	
	- server side
		1. 由于与以前的需求需要相结合，所以修改了一些地方，使其兼容
		2. 测试、上线

* 6.10（端午加班）
	- server side
		1. 为了避免购物车下单，绕过检测，为购物车下单增加了如下限制：

			
			```
			1. 购物车中若有不满足的达人、门票的限制规则，不为其下单
			2. 为其他可以正常购买的产品下单
			3. 若有 1 中不满足条件的产品，统一给出提示
			```
			
	- branch `c-2`
		1. 产品筛选页逻辑（后端）
		2. 优化搜索结果页 lazy-load

* 6.11（端午加班）
	- branch	`c-2`
		1. 用户信息编辑页（主要花时间研究了下拍照上传的实现）

	- server side
		1. 用户信息获取（涉及到前端 权限 模块，重新编写了 `详细信息` 的请求接口）
		2. 用户头像的保存（缓存部分）

* 6.12
	- branch	`c-2`
		1. 用户信息编辑页完善~
	
	- server side
		1. 用户图像保存部分（点击保存后的保存逻辑）
		2. `nginx` 服务配置，增加了一个 domain：`http://t.dogplanet.cn`，用来放置用户头像，以便随时更新。


* 6.13
	- branch	`c-2`
		1. 产品筛选页前端逻辑（三级联动比较复杂）
		2. 搜索历史纪录功能

* 6.14
	- server side
		1. 产品筛选页后端逻辑（统计菜单条目、结果）

	- branch	`c-2`
		1. 产品筛选页、达人筛选页翻页逻辑

* 6.15
	- branch	`c-2`
		1. 搜索历史纪录使用 `队列` 重写，目前最多支持 5 个
		2. 购物车列表，增加 lazy-load
		3. 购物车列表页，增加 banner 处显示 达人姓名或者景区名
		4. 筛选列表页产品、达人跳转
		5. 达人筛选页日期（从当日开始一周）

	- server side
		1. 购物车列表页数据，在产品中追加 `expertName` (可能是景区如 `蜈支洲景区`，也可能是 `陈成达人` 或 `陈成导游`)
			
* 6.16
	1. branch	`c-2`
		1. 修复测试 bug
	
	2. branch	`master`
		1. 测试 `react-router 2.4.0`，还未更新至线上。

* 6.17
* 6.20 
* 6.21
	- server side
		1. 首页搜索，过滤掉了 `达人产品`，因为现在 `达人产品` 没有实质意义，以及归属问题，无从判断。
		2. 首页搜索 `潜水`，在列表页点击 `更多`，在手机端会卡死，原因是由于后台处理了太长时间，导致 前端 `request timeout`。
			- 排查了 `redis` 缓存 key 的问题
			- 排查了 `product_search` 的处理问题
			- 原因在于，优化数据的时候，没有对 **`产品的关联达人`** 做限制，导致每次检索，每个产品都会查出 几千条达人（注意最后在列表页使用的，仅仅只有 5 个，在产品详情页，使用的则是 8 个）。
		3. 优化过后，由原先的 15s+ 的加载时间，变为 1s 以内。

* 6.22
* 6.23
* 6.24
* 6.25（六）
* 6.26（日）